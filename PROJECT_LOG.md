# 🍔 Onsia DB - 네이버 지도 크롤링 프로젝트 로그

> **프로젝트 시작일**: 2025-09-15
> **목적**: 네이버 지도에서 맛집 정보를 자동으로 수집하는 웹 애플리케이션 개발

---

## 📋 프로젝트 개요

### 🎯 최종 목표
- 네이버 지도 검색 결과를 자동으로 크롤링
- 정확한 상호명, 전화번호, 주소 추출
- 웹 인터페이스로 간편하게 관리
- Excel 내보내기 기능

### 🛠️ 기술 스택
- **Backend**: Node.js + Express.js
- **Database**: SQLite
- **Crawler**: Puppeteer
- **Frontend**: Vanilla HTML/CSS/JavaScript
- **Package Manager**: npm

---

## 📁 프로젝트 구조

```
onsia_DB/
├── server.js                 # Express 서버
├── crawler-service.js        # Puppeteer 크롤러
├── package.json              # 프로젝트 설정
├── database.db               # SQLite 데이터베이스
└── public/
    ├── index.html             # 메인 페이지
    ├── app.js                 # 프론트엔드 로직
    └── style.css              # 스타일링
```

---

## 🎉 완성된 기능

### ✅ 1. 웹 서버 및 데이터베이스
- **Express.js 서버** (포트 3000)
- **SQLite 데이터베이스** 자동 초기화
- **searches 테이블**: 검색 기록 저장
- **places 테이블**: 장소 정보 저장

### ✅ 2. 크롤링 시스템
- **Puppeteer 기반** 실제 네이버 지도 접속
- **봇 감지 우회** 기능
- **다중 추출 방식**:
  - iframe 내부 데이터 추출
  - 메인 페이지 추출
  - 텍스트 패턴 매칭
- **느리고 정확한** 크롤링 (30초 대기)

### ✅ 3. 웹 인터페이스
- **자동 수집 모드**: 검색어 입력 → 자동 크롤링
- **수동 입력 모드**: 네이버 지도 열기 → 수동 입력
- **데이터 관리**: 저장, 삭제, 필터링
- **Excel 내보내기**: CSV 형태로 다운로드
- **네이버 지도 연결**: 클릭으로 실제 장소 확인

### ✅ 4. 사용자 경험
- **반응형 디자인**
- **실시간 상태 표시**
- **토스트 알림**
- **진행 상황 표시**

---

## 🔧 주요 코드 섹션

### 📡 API 엔드포인트

```javascript
// 자동 크롤링
POST /api/crawl
{
  "query": "처인구 맛집"
}

// 검색 기록
GET /api/searches
POST /api/searches

// 장소 관리
GET /api/places
POST /api/places
PUT /api/places/:id
DELETE /api/places/:id
```

### 🤖 크롤러 핵심 로직

```javascript
class NaverMapCrawler {
  async init() {
    this.browser = await puppeteer.launch({
      headless: false,
      args: ['--no-sandbox', '--disable-blink-features=AutomationControlled']
    });
  }

  async searchPlaces(query) {
    const searchUrl = `https://map.naver.com/p/search/${encodeURIComponent(query)}`;
    await this.page.goto(searchUrl);

    // 3단계 추출 시도
    const places = await this.extractFromSearchFrame(frame) ||
                   await this.extractFromMainPage() ||
                   await this.extractFromText();

    return places;
  }
}
```

---

## 🐛 현재 해결 중인 문제

### ❌ 전화번호 추출 이슈
**문제**: 네이버 지도가 리스트에서 전화번호를 숨김
**증상**: 상호명은 추출되지만 전화번호가 "전화번호 없음"으로 표시
**원인**: 네이버 지도 DOM 구조 변경으로 기존 셀렉터 무효화

**현재 시도한 해결책**:
1. ✅ 다양한 전화번호 정규식 패턴 추가
2. ✅ 새로운 셀렉터 (`.xlx7Q`) 추가
3. ✅ 전체 페이지 스캔 및 디버깅
4. 🔄 주변 요소에서 전화번호 검색 (진행 중)

**디버깅 로그에서 발견**:
- 0507 패턴이 페이지에 3개 존재
- HTML/BODY/SCRIPT 태그에만 있고 실제 리스트 아이템에는 없음
- 전화번호 관련 셀렉터들이 모두 빈 값

---

## 📊 진행 상황

### 🎯 완성도
- **전체**: 85% ✅
- **서버/DB**: 100% ✅
- **웹 인터페이스**: 100% ✅
- **크롤링 구조**: 100% ✅
- **전화번호 추출**: 30% ❌ (핵심 이슈)

### 📈 개선 필요 사항
1. **전화번호 추출 완전 해결** (최우선)
2. 주소 추출 정확도 향상
3. 크롤링 속도 최적화
4. 에러 핸들링 강화

---

## 🚀 실행 방법

### 설치 및 실행
```bash
# 의존성 설치
npm install

# 서버 실행
npm run dev

# 브라우저에서 접속
http://localhost:3000
```

### 사용법
1. **자동 수집**: "처인구 맛집" 입력 → 🚀 자동 수집 클릭
2. **수동 입력**: "수동 입력" 클릭 → 네이버 지도에서 확인 → 직접 입력
3. **데이터 확인**: 저장된 장소 클릭 → 네이버 지도에서 검증
4. **Excel 내보내기**: "Excel 내보내기" 버튼 클릭

---

## 📝 일일 작업 로그

### 📅 2025-09-15 (Day 1)
**주요 성과**:
- ✅ Express 서버 및 SQLite DB 구축
- ✅ Puppeteer 크롤러 기본 구조 완성
- ✅ 웹 인터페이스 완전 구현
- ✅ 자동/수동 모드 구현
- ✅ 네이버 플레이스 연결 기능
- ✅ CSV 내보내기 기능

**해결한 문제**:
- `pnpm run dev` 실패 → Node.js 프로젝트로 재구성
- "detached Frame" 에러 → 매번 새 크롤러 인스턴스 생성
- 한글 인코딩 문제 → UTF-8 처리 개선
- 크롤링 속도 문제 → 30초 느린 크롤링으로 변경

**미해결 이슈**:
- ❌ 전화번호 추출 실패 (네이버 지도 구조 변경)

**다음 작업 계획**:
- 전화번호 추출 문제 완전 해결
- 개별 장소 클릭을 통한 상세 정보 가져오기
- 주소 추출 정확도 향상

---

## 🎓 배운 점

### 기술적 학습
- **Puppeteer**로 SPA 크롤링하는 방법
- **iframe** 내부 데이터 추출 기법
- **봇 감지 우회** 기술
- **Express + SQLite** 빠른 프로토타이핑

### 문제 해결 경험
- 복잡한 웹사이트 DOM 구조 분석
- 비동기 크롤링 최적화
- 실시간 디버깅 시스템 구축

---

## 🔮 향후 계획

### 단기 목표 (1주일)
- [ ] 전화번호 추출 완전 해결
- [ ] 주소 추출 정확도 90% 이상
- [ ] 에러 처리 강화

### 중기 목표 (1개월)
- [ ] 다른 지역 검색 지원
- [ ] 카테고리별 필터링
- [ ] 데이터 중복 제거
- [ ] 백그라운드 크롤링

### 장기 목표 (3개월)
- [ ] 다른 지도 서비스 지원 (카카오맵 등)
- [ ] 사용자 계정 시스템
- [ ] 크롤링 스케줄링
- [ ] 모바일 앱 개발

---

## 💡 아이디어 노트

### 개선 아이디어
- 크롤링 결과 품질 점수 시스템
- 자동 데이터 검증 기능
- 실시간 협업 기능
- AI 기반 카테고리 자동 분류

### 기술 실험
- Selenium vs Playwright 성능 비교
- 헤드리스 vs 일반 브라우저 성능
- 프록시 로테이션으로 안정성 향상

---

## 📞 연락 및 지원

**이슈 발생 시**: PROJECT_LOG.md 파일에 문제 상황 기록
**개선 아이디어**: 💡 아이디어 노트 섹션에 추가
**일일 진행**: 📝 일일 작업 로그에 업데이트

---

> **마지막 업데이트**: 2025-09-15
> **다음 작업**: 전화번호 추출 문제 해결 🔧